* Завести конфиг со списком интерфейсов и их свойствами 

* Gprs не должен переподнимать pppd 

* Функция перезапуска каналов GPRS(<список каналов>,<flUsbReset>)
***** Останавливаем ipnotifyd
***** Останавливаем gprs модули и pppd 
***** Выключаем модемы
***** !!!!!!!!! Ресетим USB драйвер 
***** Включаем модемы
***** Проверяем наличие интерфейсов tty каналов 
***** Если нет хотя бы одного канала 
****** делаем reboot
***** Запускаем ipnotifyd
***** Запускаем gprs каналы
***** Ждем появления ppp интерфейсов

* Порядок реконфига в случае потери интерфейса 
** Для gprs: 
*** Спим N секунд
**** Считываем список включенных каналов
**** Проверяем наличие интерфейсов tty каналов(<список включенных каналов>) 
**** Если нет ни одного канала 
***** Функция перезапуска каналов GPRS(<список отсутствующих каналов>,<flUsbReset=true>)
**** Если нет нескольких каналов 
***** Функция перезапуска каналов GPRS(<список отсутствующих каналов>,<flUsbReset=false>)
**** Проверяем наличие интерфейсов ppp(<список включенных каналов>)
**** Если нет нескольких интерфейсов ppp
***** Выполняем перезапуск gprs модулей(<список включенных каналов>)
****** Ждем появления ppp интерфейсов(<список включенных каналов>)
****** Если нет нескольких интерфейсов ppp
******* Функция перезапуска каналов GPRS(<список отсутствующих каналов>,<flUsbReset=false>)
**** Проверяем трафик RX ppp интерфейса(<список включенных каналов>) 
**** Если на нескольких интерфейсах ppp трафик не растет в течении N минут
***** Выполняем перезапуск gprs модулей(<список мертвых каналов>)

* <Маршрутизация> и <Привязка к источникам>
** Либо ipnotifyd
*** Добавим RTM_NEWROUTE, RTM_DELROUTE, RTM_GETROUTE  [[http://man7.org/linux/man-pages/man7/rtnetlink.7.html]] для шлюзов
*** Материалы по netlink (тег в firefox C++netlink)
**** https://github.com/Quagga/quagga/blob/88d6516676cbcefb6ecdc1828cf59ba3a6e5fe7b/zebra/rt_netlink.c
**** https://github.com/Quagga/quagga/blob/88d6516676cbcefb6ecdc1828cf59ba3a6e5fe7b/zebra/zebra_fpm_netlink.c
**** https://github.com/slankdev/routerd/tree/d5dcae6ed613126600dec7b8b0801634ed03deed
**** https://www.opennet.ru/man.shtml?topic=netlink&category=7&russian=0
**** https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=rtnetlink&category=7

*** Меняем <МаршрутПоУмолчанию> интерфейса при изменении <ОбщегоМаршрутаПоУмолчанию>.
*** Добавляем в конфиги сетевых приложений <ip источника> при изменении ip интерфейса  сетевого приложения или vpn-канала
*** Перезапуск при изменении конфига следующих приложений:
**** Интерфейсы
***** gprs_config(ppp) 
***** openvpn_config(tun/tap) 
***** ethernet_config(eth0/usbeth0/usbeth1)
**** Сетевые приложения
***** communch-ip_config
** Либо вместо  ipnotifyd делаем маршруты по портам 
*** В этом случае к источнику не привязываем а заводим приложение мониторящее изменение конфига по inotify
*** и когда изменяется порт перенастраиваем таблицу маршрутицации

* Добавить произвольные опции в генератор конфигов из json файлов(для отдельного канала и общие)

* Перевести на json каналы связи и интерфейсы



* Ближайшие планы:
** Добавляем в communch-ip не только Прямое соединение но и другие интерфейсы (ppp, eth итд.)
** Заводим IpSource в communch-ip  
** В IpConnector считываем IpSource
** В ipnotifyd реконфигурируем communch-ip при изменении Ip источника, изменяем IpSource
** Маршрутизацию переносим из communch-ip в routeconf:  
** Добавляем в netconf флаг "Сделать шлюз , шлюзом по умолчанию" 
** В ipnotifyd реконфигурируем netconf при изменении Ip источника, перестраиваем маршрут.
** Контроль RX на ppp интерфейсе
** Отслеживание измения маршрутов по умолчанию, с целью их привязки к сетевым интерфейсам


* Привязка модемов к tty 

** Перед запуском прикладного ПО (sysup и udev) генерируем правила udev привязывая модемы к IMEI-TTY, для этого:
*** Проверяем правила udev
*** Если модемы привязаны в  правилах udev 
**** Запускаем udev
*** Если модемы НЕ привязаны в  правилах udev 
**** Останавливаем все модемы
***** Запускаем один модем
***** Считываем IMEI
***** Записываем связку IMEI-TTY в правило udev
***** Повторяем для остальных модемов
***** Запускаем udev

** В рабочем режиме
*** При подключении  модема udev  правило ловит управляющий порт - например /dev/ttyACM3 
*** Считывает IMEI. 
*** Ищет IMEI в правилах 
*** Если находит
**** Проверяет есть ли такой симлинк уже
**** Если находит
***** Останавливает следилки за ppp и канал связи
***** Удаляет симлинк и создает заново
**** Если не находит
***** Делает симлинк
**** Перезапускает следилки за ppp и  канал связи


     idVendor=1e2d, idProduct=0058


* Контроль gprs
** udev 
*** Появился tty запускаем gprs(инициализация модема запуск pppd)   (пишем в лог)
*** Пропал tty останавливаем gprs (пишем в лог)
** ipnotifyd 
*** Пропал ppp интерфейс  запускаем gprs(инициализация модема запуск pppd) (пишем в лог)     
** powercontrol-modem
*** Нету долго пакетов через ppp интерфейс  (пишем в лог)
**** останавливаем  модем
**** запускаем модем 



* сегодня
** отделяем checkrx в отдельный репозиторий и снабжаем его вебкой (выключаем по умолчанию)
** выносим канал gprs из настроек каналов связи в отдельный пункт меню
** отключаем в канале gprs контроль timeout protect
** добавляем в каналы связи возможность выбора источника сетевых интерфейсов ppp eth


